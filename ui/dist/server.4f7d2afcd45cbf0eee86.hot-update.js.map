{"version":3,"sources":["webpack:///./src/SignInNavItem.jsx"],"names":["SignInNavItem","React","Component","constructor","props","state","showing","disabled","user","signedIn","givenName","signIn","bind","signOut","showModal","hideModal","setState","componentDidMount","clientId","window","ENV","GOOGLE_CLIENT_ID","gapi","load","auth2","getAuthInstance","init","client_id","then","loadData","apiEndpoint","UI_AUTH_ENDPOINT","response","fetch","method","headers","body","text","result","JSON","parse","showError","googleToken","googleUser","getAuthResponse","id_token","error","stringify","google_token","console","log","onUserChange","er","render","withToast"],"mappings":"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","file":"server.4f7d2afcd45cbf0eee86.hot-update.js","sourcesContent":["import React from \"react\";\nimport { NavItem, Modal, Button, NavDropdown, MenuItem } from \"react-bootstrap\";\nimport withToast from \"./withToast.jsx\";\n\nclass SignInNavItem extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      showing: false,\n      disabled: true,\n      user: { signedIn: false, givenName: \"\" },\n    };\n    this.signIn = this.signIn.bind(this);\n    this.signOut = this.signOut.bind(this);\n    this.showModal = this.showModal.bind(this);\n    this.hideModal = this.hideModal.bind(this);\n  }\n\n  showModal() {\n    this.setState({ showing: true });\n  }\n  hideModal() {\n    this.setState({ showing: false });\n  }\n\n  async componentDidMount() {\n    const clientId = window.ENV.GOOGLE_CLIENT_ID;\n    if (!clientId) return;\n    window.gapi.load(\"auth2\", () => {\n      if (!window.gapi.auth2.getAuthInstance()) {\n        window.gapi.auth2.init({ client_id: clientId }).then(() => {\n          this.setState({ disabled: false });\n        });\n      }\n    });\n    await this.loadData();\n  }\n\n  async loadData() {\n    const apiEndpoint = window.ENV.UI_AUTH_ENDPOINT;\n    const response = await fetch(`${apiEndpoint}/user`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\", \"Same-Site\": \"None\" },\n    });\n    const body = await response.text();\n    const result = JSON.parse(body);\n    const { signedIn, givenName } = result;\n    this.setState({ user: { signedIn, givenName } });\n  }\n\n  async signIn() {\n    this.hideModal();\n    const { showError } = this.props;\n    let googleToken;\n    try {\n      const auth2 = window.gapi.auth2.getAuthInstance();\n      const googleUser = await auth2.signIn();\n      googleToken = googleUser.getAuthResponse().id_token;\n    } catch (error) {\n      showError(`Error authenticating with Google:${error.error}`);\n    }\n    try {\n      const apiEndpoint = window.ENV.UI_AUTH_ENDPOINT;\n      const response = await fetch(`${apiEndpoint}/signin`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\", \"Same-Site\": \"None\" },\n        body: JSON.stringify({ google_token: googleToken }),\n      });\n      const body = await response.text();\n      const result = JSON.parse(body);\n      console.log({ result });\n      const { signedIn, givenName } = result;\n      const { onUserChange } = this.props;\n      onUserChange({ signedIn, givenName });\n    } catch (error) {\n      showError(`Error signing into the app: ${error}`);\n    }\n  }\n\n  async signOut() {\n    this.hideModal();\n    const apiEndpoint = window.ENV.UI_AUTH_ENDPOINT;\n    const { showError } = this.props;\n    try {\n      await fetch(`${apiEndpoint}/signout`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\", \"Same-Site\": \"None\" },\n      });\n      const auth2 = window.gapi.auth2.getAuthInstance();\n      await auth2.signOut();\n      const { onUserChange } = this.props;\n      onUserChange({ signedIn: false, givenName: \"\" });\n    } catch (er) {\n      showError(`error signing out ${er}`);\n    }\n  }\n\n  showModal() {\n    const clientId = window.ENV.GOOGLE_CLIENT_ID;\n    const { showError } = this.props;\n    if (!clientId) {\n      showError(\"Missing environment variable GOOGLE_CLIENT_ID\");\n      return;\n    }\n    this.setState({ showing: true });\n  }\n\n  render() {\n    const { user } = this.props;\n    const { showing, disabled } = this.state;\n    if (user.signedIn) {\n      return (\n        <NavDropdown title={user.givenName} id=\"user\">\n          <MenuItem onClick={this.signOut}>Sign out</MenuItem>\n        </NavDropdown>\n      );\n    } else {\n      return (\n        <>\n          <NavItem onClick={this.showModal}>Sign in</NavItem>\n          <Modal show={showing} onHide={this.hideModal} bsSize=\"sm\">\n            <Modal.Header closeButton>\n              <Modal.Title>Sign</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n              <Button\n                block\n                bsStyle=\"primary\"\n                onClick={this.signIn}\n                disabled={disabled}\n              >\n                <img\n                  src=\"https://developers.google.com/identity/images/btn_google_signin_light_normal_web.png\"\n                  alt=\"Sign In\"\n                />\n              </Button>\n            </Modal.Body>\n            <Modal.Footer>\n              <Button bsStyle=\"link\" onClick={this.hideModal}>\n                Cancel\n              </Button>\n            </Modal.Footer>\n          </Modal>\n        </>\n      );\n    }\n  }\n}\nexport default withToast(SignInNavItem);\n"],"sourceRoot":""}